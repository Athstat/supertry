# Password Reset Flow Test
# Tests the password reset functionality
# Flow: Request reset → Enter email → Reset password → Sign in with new password

appId: ${BASE_URL}
tags:
  - auth
  - password-reset
---
# Launch the web app
- launchApp:
    appId: chrome
    arguments:
      - "--new-window"
      - "${BASE_URL}/signin"

# Wait for page to load
- assertVisible: "Welcome back"

# ============================================
# Navigate to Forgot Password
# ============================================
# Look for forgot password link
- assertVisible:
    text: ".*([Ff]orgot [Pp]assword).*"

# Tap on forgot password link
- tapOn:
    text: ".*([Ff]orgot [Pp]assword).*"

# Wait for navigation
- waitForAnimationToEnd

# ============================================
# Enter Email for Reset
# ============================================
- assertVisible:
    text: ".*([Ff]orgot|[Rr]eset).*"

# Tap on email input field
- tapOn:
    text: ".*[Ee]mail.*"
    index: 0

# Input test email
- inputText: "${TEST_EMAIL}"

# Submit request
- tapOn:
    text: ".*([Ss]end|[Rr]eset|[Ss]ubmit).*"

# Wait for confirmation
- waitForAnimationToEnd

# ============================================
# Verification: Confirmation Message
# ============================================
# Check for success message or email sent confirmation
- assertVisible:
    text: ".*([Ee]mail [Ss]ent|[Cc]heck [Yy]our [Ee]mail|[Ss]ent).*"
    timeout: 5000

# Take screenshot for test evidence
- takeScreenshot: password-reset-requested

# Note: In a real test, you would need to:
# 1. Access the email inbox (via API or test service)
# 2. Extract the reset link
# 3. Navigate to the reset link
# 4. Set new password
# 5. Verify login with new password
# This simplified version just tests the request flow

# Output test results
- evalScript: |
    console.log('✅ Password Reset Request Test Passed');
    console.log('Reset email requested for: ${TEST_EMAIL}');
    console.log('Note: Full reset flow requires email verification');
